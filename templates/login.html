{% extends "main.html" %}
{% block head_extension %}
{% endblock %}
{% block content %}
<div class="row">
    <div class="col-xs-12">
        <!-- BEGIN Google login -->
        <div id="signinButton" class="g-signin2" data-onsuccess="onSignIn" data-onfailure="onSignInFailure"></div>
        <div id="result"></div>
        <script>
        function onSignIn(googleUser) {
            var id_token = googleUser.getAuthResponse().id_token;
            if (id_token) {
                // Hide the sign-in button now that the user is authorized
                $('#signinButton').attr('style', 'display: none');
                
                // Send the id token to the server
                // If the server responds, write a 'login successful' message
                // to the web page and then redirect back to the main 
                // itemcatalog page
                let requestData = {
                    'idtoken': id_token
                };
                $.ajax({
                    type: 'POST',
                    url: '/gconnect?state={{STATE}}',
                    data: JSON.stringify(requestData),
                    contentType: 'application/json; charset=utf-8'
                }).done(function(result){
                    // Handle or verify the server response if necessary.
                    if (result) {
                        window.location.href = "/welcome/";
                    } else {
                        $('#result').html('Failed to make a server-side call. Check your configuration and console.');
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.log(errorThrown);
                });
            }
        
            //var profile = googleUser.getBasicProfile();
            //console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
            //console.log('Name: ' + profile.getName());
            //console.log('Image URL: ' + profile.getImageUrl());
            //console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
        }
        
        function onSignInFailure(error) {
            var errorMessage = 'Login failure, error message: ' + error;
            $('#result').html(errorMessage);
        }
        </script>
        <!-- END Google login -->
    </div>
</div>
{% endblock %}